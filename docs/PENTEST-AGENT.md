# BSU Automated Penetration Testing Agent

## Overview

The BSU Penetration Testing Agent is a comprehensive automated security scanning solution that integrates seamlessly with the BSM platform. It provides continuous security monitoring, vulnerability detection, and automated reporting.

## Features

### üîç Vulnerability Detection
- **SQL Injection (SQLi)**: Detects error-based and blind SQL injection vulnerabilities
- **Cross-Site Scripting (XSS)**: Identifies reflected XSS vulnerabilities
- **Cross-Site Request Forgery (CSRF)**: Checks for missing CSRF tokens
- **API Security**: Tests authentication, authorization, and rate limiting
- **OWASP ZAP Integration**: Full comprehensive security scanning

### üìä Reporting & Analytics
- **CVSS Scoring**: Automatic CVSS score calculation for each vulnerability
- **Multiple Report Formats**: JSON, HTML, Markdown, and PDF
- **Security Score Tracking**: Historical security score trends
- **Detailed Remediation**: Step-by-step fix instructions

### üîî Notifications & Alerts
- **Slack Integration**: Real-time alerts for critical findings
- **Email Notifications**: Detailed security reports via email
- **GitHub PR Comments**: Automated security feedback on pull requests

### üöÄ CI/CD Integration
- **Quality Gates**: Block deployments with critical vulnerabilities
- **Automated Scanning**: Run on every PR and deployment
- **GitHub Actions**: Pre-configured workflow templates

## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BSM Platform (Node.js)                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ          API Gateway & Authentication                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                            ‚îÇ                                  ‚îÇ
‚îÇ                            ‚ñº                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ         Pentest Agent Service (Node.js)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Routes & Controllers                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Deployment Quality Gates                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Pentest Service (Python/FastAPI)                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Scanners:                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SQL Injection Scanner                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ XSS Scanner                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ CSRF Scanner                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ API Security Tester                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ OWASP ZAP Integration                            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Services:                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Report Generator                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Notification Service (Slack/Email)               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ MongoDB Client                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Data Storage                            ‚îÇ
‚îÇ  ‚Ä¢ MongoDB: Scan results and history                        ‚îÇ
‚îÇ  ‚Ä¢ File System: Generated reports                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Installation

### Prerequisites
- Node.js 22+
- Python 3.11+
- MongoDB 7.0+
- Docker (optional, for containerized deployment)

### Quick Start with Docker

1. **Start the services:**
```bash
cd services/pentest
docker-compose -f docker-compose.pentest.yml up -d
```

2. **Verify services are running:**
```bash
curl http://localhost:8001/health
```

### Manual Installation

1. **Install Python dependencies:**
```bash
cd services/pentest
pip install -r requirements.txt
```

2. **Configure environment variables:**
```bash
cp .env.example .env
# Edit .env with your configuration
```

3. **Start MongoDB:**
```bash
docker run -d -p 27017:27017 mongo:7.0
```

4. **Start the pentest service:**
```bash
python main.py
```

5. **Start the BSM platform:**
```bash
cd ../..
npm ci
npm start
```

## Configuration

### Environment Variables

```bash
# Pentest Service Configuration
PENTEST_SERVICE_URL=http://localhost:8001
MONGODB_URI=mongodb://localhost:27017/bsu_pentest
ZAP_API_KEY=your-secure-key

# Notification Settings
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your-email@example.com
EMAIL_PASSWORD=your-app-password
EMAIL_FROM=security@example.com
EMAIL_TO=team@example.com
```

## Usage

### API Endpoints

#### Start a Security Scan

```bash
POST /api/pentest/scan
Content-Type: application/json

{
  "targetUrl": "https://example.com",
  "scanTypes": ["sql", "xss", "csrf", "api"],
  "authToken": "optional-bearer-token",
  "authType": "bearer",
  "apiEndpoints": [
    "https://api.example.com/users",
    "https://api.example.com/posts"
  ],
  "maxDepth": 3
}

Response:
{
  "scan_id": "uuid-here",
  "status": "queued",
  "message": "Scan has been queued for processing"
}
```

#### Get Scan Status

```bash
GET /api/pentest/scan/{scanId}

Response:
{
  "scan_id": "uuid",
  "status": "completed",
  "progress": 100,
  "vulnerabilities_found": 5,
  "severity_breakdown": {
    "critical": 0,
    "high": 2,
    "medium": 3,
    "low": 0
  }
}
```

#### Get Scan Report

```bash
GET /api/pentest/scan/{scanId}/report?format=json|html|markdown

Response: Detailed vulnerability report in requested format
```

#### Check Deployment Readiness

```bash
POST /api/pentest/deployment-check
Content-Type: application/json

{
  "scanId": "uuid"
}

Response:
{
  "blocked": false,
  "warning": "2 high-severity vulnerabilities found",
  "action": "Review and plan remediation"
}
```

### CLI Usage

```bash
# Start a scan
curl -X POST http://localhost:8001/api/scan \
  -H "Content-Type: application/json" \
  -d '{"target_url": "https://example.com", "scan_types": ["all"]}'

# Check scan status
curl http://localhost:8001/api/scan/{SCAN_ID}

# Get report
curl http://localhost:8001/api/scan/{SCAN_ID}/report?format=markdown > report.md
```

### GitHub Actions Integration

Add to your workflow:

```yaml
- name: Security Scan
  uses: ./.github/workflows/pentest-scanner.yml
  with:
    target_url: ${{ secrets.STAGING_URL }}
    scan_types: 'all'
```

## Security Dashboard

Access the dashboard at:
```
http://localhost:3000/pentest-dashboard/
```

Features:
- Real-time security score
- Vulnerability statistics
- Scan history
- Interactive charts
- Detailed vulnerability information

## Security Quality Gates

The system enforces the following quality gates:

| Severity | Threshold | Action |
|----------|-----------|--------|
| Critical | > 0 | ‚ùå Block deployment |
| High | > 5 | ‚ùå Block deployment |
| High | 1-5 | ‚ö†Ô∏è Warning, allow with review |
| Medium | Any | ‚úÖ Allow with notification |
| Low | Any | ‚úÖ Allow |

## Remediation Guidance

Each vulnerability includes:
- **CVSS Score**: Industry-standard severity rating
- **Description**: Clear explanation of the issue
- **Evidence**: Proof of vulnerability (payload, response)
- **Solution**: High-level fix recommendation
- **Remediation Steps**: Detailed implementation steps
- **References**: OWASP and CWE links

## Best Practices

### For Developers
1. **Run scans early**: Test in development before deployment
2. **Fix critical issues immediately**: Don't wait for CI/CD to catch them
3. **Review reports**: Understand each vulnerability
4. **Update dependencies**: Keep libraries up to date
5. **Use provided remediation**: Follow the step-by-step guides

### For Security Teams
1. **Monitor trends**: Track security score over time
2. **Set quality gates**: Define acceptable thresholds
3. **Review regularly**: Weekly vulnerability audits
4. **Document exceptions**: Maintain a list of accepted risks
5. **Train developers**: Share common vulnerability patterns

### For DevOps
1. **Automate scans**: Integrate into CI/CD pipeline
2. **Configure notifications**: Set up Slack/email alerts
3. **Maintain reports**: Archive historical scan data
4. **Monitor performance**: Track scan duration and success rates
5. **Update regularly**: Keep scanners and signatures current

## Troubleshooting

### Service Won't Start

Check logs:
```bash
docker-compose -f docker-compose.pentest.yml logs -f pentest-service
```

Common issues:
- MongoDB not running
- Port conflicts (8001, 8080, 27017)
- Missing environment variables

### Scans Timing Out

Increase timeout:
```bash
export SCAN_TIMEOUT_SECONDS=7200  # 2 hours
```

### False Positives

Mark in MongoDB:
```javascript
db.scans.updateOne(
  { scan_id: "uuid", "vulnerabilities.url": "..." },
  { $set: { "vulnerabilities.$.false_positive": true } }
)
```

## Performance

- **SQL Injection Scan**: ~30 seconds per endpoint
- **XSS Scan**: ~20 seconds per parameter
- **CSRF Scan**: ~10 seconds per form
- **API Testing**: ~15 seconds per endpoint
- **Full ZAP Scan**: 5-30 minutes (depending on site size)

## Limitations

- **JavaScript-heavy sites**: May miss client-side vulnerabilities
- **Authenticated areas**: Requires valid tokens/credentials
- **Rate limiting**: May be blocked by aggressive rate limiters
- **False positives**: Manual review recommended for critical findings

## Roadmap

- [ ] Browser automation for JS-heavy sites
- [ ] Machine learning for false positive reduction
- [ ] Custom vulnerability signatures
- [ ] Multi-tenant support
- [ ] Advanced authentication flows
- [ ] Integration with Burp Suite
- [ ] PDF report generation
- [ ] Executive summary dashboards

## Support

- **Documentation**: `/docs/pentest/`
- **Issues**: https://github.com/MOTEB1989/BSM/issues
- **Security**: Report vulnerabilities privately to security@lexdo.uk

## License

Proprietary - BSM Platform
