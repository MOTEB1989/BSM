name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
    paths:
      - 'docs/**'
      - '.github/workflows/deploy.yml'
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages-deploy"
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4
        
      - name: Set up Node.js
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4
        with:
          node-version: '22'
          
      - name: Create docs/config.js
        env:
          API_BASE: ${{ secrets.API_BASE_URL }}
        run: |
          mkdir -p docs
          echo "/* Auto-generated by GitHub Actions */" > docs/config.js
          node -e "console.log('window.__ENV__ = { API_BASE: ' + JSON.stringify(process.env.API_BASE || 'https://sr-bsm.onrender.com') + ' };');" >> docs/config.js
          cat docs/config.js
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@373f7f263a76c20808c831209c920827a82a2847 # v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          cname: www.lexdo.uk
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: 'Deploy docs to GitHub Pages'
          
      - name: Deployment Summary
        run: |
          echo "âœ… Successfully deployed to GitHub Pages"
          echo "ğŸ“ Deployed files from: docs/"
          echo "ğŸŒ URL: https://www.lexdo.uk"
          echo "ğŸ”— Kimi Chat: https://www.lexdo.uk/kimi-chat.html"
