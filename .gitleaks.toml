# ============================================
# BSU Platform - Gitleaks Configuration
# Secret Scanning Rules
# ============================================

title = "BSU Gitleaks Configuration"
[extend]
useDefault = true

# ============================================
# Custom Rules for BSU Platform
# ============================================

[[rules]]
id = "openai-api-key"
description = "OpenAI API Key"
regex = '''sk-[a-zA-Z0-9]{48}'''
tags = ["api-key", "openai", "critical"]

[[rules]]
id = "openai-api-key-v2"
description = "OpenAI API Key (new format)"
regex = '''sk-proj-[a-zA-Z0-9\-_]{32,}'''
tags = ["api-key", "openai", "critical"]

[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''AKIA[0-9A-Z]{16}'''
tags = ["aws", "access-key", "critical"]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)(aws.{0,20}secret.{0,20}['"\\s:=]+)([a-zA-Z0-9/+=]{40})'''
tags = ["aws", "secret-key", "critical"]

[[rules]]
id = "github-pat"
description = "GitHub Personal Access Token"
regex = '''ghp_[a-zA-Z0-9]{36}'''
tags = ["github", "token", "critical"]

[[rules]]
id = "github-oauth"
description = "GitHub OAuth Token"
regex = '''gho_[a-zA-Z0-9]{36}'''
tags = ["github", "token", "critical"]

[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey|api[_-]?secret)(['"\s:=]+)([a-zA-Z0-9\-_]{20,})'''
tags = ["api-key", "generic", "high"]

[[rules]]
id = "admin-token"
description = "Admin Token"
regex = '''(?i)(admin[_-]?token|admin[_-]?secret|admin[_-]?key)(['"\s:=]+)([a-zA-Z0-9\-_]{16,})'''
tags = ["admin", "token", "critical"]
# Note: Will match .env.example which is OK as we allowlist it below

[[rules]]
id = "private-key-rsa"
description = "RSA Private Key"
regex = '''-----BEGIN RSA PRIVATE KEY-----'''
tags = ["private-key", "rsa", "critical"]

[[rules]]
id = "private-key-openssh"
description = "OpenSSH Private Key"
regex = '''-----BEGIN OPENSSH PRIVATE KEY-----'''
tags = ["private-key", "openssh", "critical"]

[[rules]]
id = "private-key-ec"
description = "EC Private Key"
regex = '''-----BEGIN EC PRIVATE KEY-----'''
tags = ["private-key", "ec", "critical"]

[[rules]]
id = "private-key-pgp"
description = "PGP Private Key"
regex = '''-----BEGIN PGP PRIVATE KEY BLOCK-----'''
tags = ["private-key", "pgp", "critical"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_-]{10,}\.eyJ[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}'''
tags = ["jwt", "token", "medium"]

[[rules]]
id = "database-connection-string"
description = "Database Connection String"
regex = '''(?i)(mongodb|postgres|mysql|mariadb):\/\/[^\s'"]{10,}'''
tags = ["database", "connection-string", "high"]

[[rules]]
id = "slack-webhook"
description = "Slack Webhook URL"
regex = '''https://hooks\.slack\.com/services/T[a-zA-Z0-9_]{8}/B[a-zA-Z0-9_]{8}/[a-zA-Z0-9_]{24}'''
tags = ["slack", "webhook", "medium"]

[[rules]]
id = "stripe-api-key"
description = "Stripe API Key"
regex = '''sk_live_[0-9a-zA-Z]{24,}'''
tags = ["stripe", "api-key", "critical"]

[[rules]]
id = "twilio-api-key"
description = "Twilio API Key"
regex = '''SK[0-9a-fA-F]{32}'''
tags = ["twilio", "api-key", "high"]

[[rules]]
id = "sendgrid-api-key"
description = "SendGrid API Key"
regex = '''SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}'''
tags = ["sendgrid", "api-key", "high"]

[[rules]]
id = "azure-storage-key"
description = "Azure Storage Account Key"
regex = '''(?i)(azure.{0,20}storage.{0,20}['"\\s:=]+)([a-zA-Z0-9+/=]{88})'''
tags = ["azure", "storage", "critical"]

[[rules]]
id = "google-api-key"
description = "Google API Key"
regex = '''AIza[0-9A-Za-z\-_]{35}'''
tags = ["google", "api-key", "high"]

[[rules]]
id = "cloudflare-api-key"
description = "Cloudflare API Key"
regex = '''(?i)(cloudflare.{0,20}['"\\s:=]+)([a-z0-9]{37})'''
tags = ["cloudflare", "api-key", "high"]

[[rules]]
id = "heroku-api-key"
description = "Heroku API Key"
regex = '''[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}'''
tags = ["heroku", "api-key", "medium"]

[[rules]]
id = "npm-token"
description = "NPM Token"
regex = '''npm_[a-zA-Z0-9]{36}'''
tags = ["npm", "token", "high"]

[[rules]]
id = "docker-password"
description = "Docker Password"
regex = '''(?i)(docker.{0,20}password.{0,20}['"\\s:=]+)([a-zA-Z0-9\-_]{10,})'''
tags = ["docker", "password", "medium"]

[[rules]]
id = "basic-auth-url"
description = "Basic Auth in URL"
regex = '''(?i)(https?:\/\/)[a-zA-Z0-9]+:[a-zA-Z0-9]+@[a-zA-Z0-9\.\-]+'''
tags = ["basic-auth", "url", "high"]

[[rules]]
id = "password-in-url"
description = "Password in URL"
regex = '''(?i)[a-z0-9+\-\.]+:\/\/[^:]+:([^@\s]+)@'''
tags = ["password", "url", "high"]

# ============================================
# Allowlist - False Positives
# ============================================

[allowlist]
description = "Allowlist for known false positives and test files"

# Files to ignore
paths = [
  # Environment examples (no real secrets)
  '''.env.example''',
  '''.env.sample''',
  '''.env.template''',
  
  # Dependencies
  '''node_modules/''',
  '''vendor/''',
  
  # Test files
  '''test/''',
  '''tests/''',
  '''__tests__/''',
  '''*.test.js''',
  '''*.spec.js''',
  
  # Documentation
  '''docs/''',
  '''*.md''',
  
  # Build output
  '''dist/''',
  '''build/''',
  '''out/''',
  
  # This configuration file
  '''.gitleaks.toml''',
  
  # Reports (may contain findings)
  '''reports/SECURITY-AUDIT.md'''
]

# Specific patterns to ignore
regexes = [
  # Example keys in documentation
  '''sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx''',
  '''AKIA000000000000XXXX''',
  '''ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx''',
  
  # Placeholder tokens
  '''change-me''',
  '''CHANGE_ME''',
  '''your-.*-here''',
  '''<your-.*>''',
  '''\\$\\{[A-Z_]+\\}''',  # Environment variable placeholders like ${API_KEY}
  
  # Test/mock values
  '''test-api-key''',
  '''mock-token''',
  '''fake-secret'''
]

# Commits to exclude (if needed)
# commits = [
#   "commit-hash-to-exclude"
# ]

# Stop words that indicate false positives
stopwords = [
  "example",
  "sample",
  "test",
  "mock",
  "fake",
  "dummy",
  "placeholder"
]
